     name: Build Windows

     on:
       workflow_call:
       workflow_dispatch:
       push:
         branches: [main]

     jobs:
       build:
         name: Build Windows x86_64
         runs-on: windows-latest

         steps:
           - uses: actions/checkout@v4

           - name: Setup Rust
             uses: dtolnay/rust-toolchain@stable
             with:
               targets: x86_64-pc-windows-msvc

           - name: Setup Rust cache
             uses: Swatinem/rust-cache@v2
             with:
               workspaces: src-tauri

           - name: Setup Bun
             uses: oven-sh/setup-bun@v2

           - name: Install dependencies
             run: bun install

           - name: Build Tauri app
             run: bun run tauri build --target x86_64-pc-windows-msvc

           - name: Create artifacts directory
             shell: pwsh
             run: |
               New-Item -ItemType Directory -Force -Path dist/windows-x86_64

               # Copy MSI installer
               $msiFiles = Get-ChildItem -Path "src-tauri/target/x86_64-pc-windows-msvc/release/bundle/msi/*.msi" -ErrorAction SilentlyContinue
               if ($msiFiles) {
                 Copy-Item $msiFiles.FullName -Destination "dist/windows-x86_64/"
               }

               # Copy NSIS installer
               $nsisFiles = Get-ChildItem -Path "src-tauri/target/x86_64-pc-windows-msvc/release/bundle/nsis/*.exe" -ErrorAction SilentlyContinue
               if ($nsisFiles) {
                 Copy-Item $nsisFiles.FullName -Destination "dist/windows-x86_64/"
               }

               # Generate checksums
               Set-Location dist/windows-x86_64
               Get-ChildItem -File | ForEach-Object {
                 $hash = (Get-FileHash $_.Name -Algorithm SHA256).Hash.ToLower()
                 "$hash  $($_.Name)" | Out-File -Append -FilePath checksums.txt -Encoding utf8
               }

           - name: Upload artifacts
             uses: actions/upload-artifact@v4
             with:
               name: windows-x86_64
               path: dist/windows-x86_64/*
